<template>
  <custom-container title="{{title}}">
    <block wx:if="{{roleType === 'boss'}}">
      <view class="component-container">
        <component is="{{currentCom}}" categoryList="{{categoryList}}" bind:release-jump-done="releaseJumpDone"></component>
      </view>
      <footer wx:if="{{currentCom}}" list="{{footerList}}" initActive="{{currentCom}}" bind:tab-change="tabChange" />
    </block>
    <block wx:if="{{roleType === 'worker'}}">
      <view>
        <worker />
      </view>
    </block>
  </custom-container>
  <back-home />
</template>

<script>
// node: 超级流转组件，最核心的功能和流转流程
import mpx, { createPage } from '@mpxjs/core'
import config, { categoryMap } from '@/constant/release.js'
const store = getApp().globalStore

createPage({
  onShareAppMessage() {
    getApp().onShareAppMessage()
  },
  data: {
    currentCom: '',
    roleType: '',
    categoryTypeId: ''
  },
  async onLoad(params) {
    console.log(params)
    const { type, key, id } = params
    this.categoryTypeId = categoryMap[id]
    this.roleType = type
    this.currentCom = key
  },
  computed: {
    categoryList() {
      return config[this.categoryTypeId].category
    },
    footerList() {
      return [{
        name: '发单',
        title: '我要招工',
        icon: 'upgrade',
        key: 'release'
      }, {
        name: '订单列表',
        title: '订单列表',
        icon: 'comment',
        key: 'order'
      }]
    },
    title() {
      if (this.roleType === 'worker') return '我要找工作'
      return this.footerList.find(item => item.key === this.currentCom)?.title || ''
    }
  },
  methods: {
    tabChange(e) {
      this.currentCom = e.detail.key
    },
    releaseJumpDone() {
      setTimeout(() => {
        this.currentCom = 'order'
      }, 1000)
    }
  }
})
</script>

<style lang="stylus" scoped>
.component-container
  box-sizing border-box
  padding-bottom 150rpx
</style>
<script type="application/json">
  {
    "usingComponents": {
      "custom-container": "@/compontens/base/custom-container",
      "back-home": "@/compontens/base/back-home.mpx",
      "footer": "@/compontens/base/footer.mpx",
      "order": "@/subpackages/superstream/compontens/order",
      "release":"@/subpackages/superstream/compontens/release",
      "worker": "@/subpackages/superstream/compontens/order/worker.mpx"
    },
    "disableScroll": true
  }
</script>
